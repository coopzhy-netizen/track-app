<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="TRACK //">
<meta name="application-name" content="TRACK //">
<meta name="theme-color" content="#0a0a0a">
<meta name="description" content="Daily weight loss tracker">
<link rel="apple-touch-icon" sizes="192x192" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAIAAADdvvtQAAADHUlEQVR42u3d0W3DMAwE0Hxzse6/RbZodyhlS+K9w/3bIB6aoLHFT4k08jECAUgAEoAEIBGABCABSAASAUgAEoAEIBGABCC5GtD390dnFyAFSAFSgAACCCAFSAFSgAACCCAFSAFSgBSgBwH5mfrAAFR0ArRmBDQAtGAETADUvToWAC24OhwAda/OB0ALrk4JQN2rgwJQ9+oYAdQFxBBAXUAYAbQAEEMAdQFhBNACQAwBVO8/7wIQQAwBtBpQJiOAau/jmwABFM0IoDrkSXKAAEpkBFCd9lILQAAFMQLo1dcaAQIII4B2A5pkCKCdb+YDBFC6IYD2G7qaEUAMAYQRQOcMlyGAMALogJkyBBBGAB0wSoYAwgigAybIEEB++gAo2xBAEwBtZATQHEDlYTSArmME0EBAFfxkPkCXMQJoMqDKe00RoMsYARQBqGLObADoMkYAZQGq6QdYAXQZI4BCAdXQ0zwBuowRQOmAatbR5gBdxggggFqGAAKoxQigOYAW3hJAoYDW3hVAiYBeNgTQQEBvMgJoLKB3DAE0GdDymwQoDtDThgCaD+iJWwUoC9Bzf4oACgKUsPEJoLNmBxBA1j0BtBqQX4IB6gKy7gmgBYBiH4sDaBkg+8IA6gKyLwygLqC0l0wAWg/IvjCA7JwD6ABAFs4BZOEcQLsBzT6/BqA3AFk4B1CcIYBOBGRjIUA2FgK0G9Cko7EB2gPIxsLJgBgCiCGAkhgBNBZQrCGAfJwBxBBAgf+cnWEIIF+JAGIIIOueLmUEEEMAMbRvRAD5SgQQQ/sGBZCPM4AY2jcxgBgCCKN9cwOIIYAY2jc9gFIMAeTAZYAA2scIoAhAdduZDQClGAIoCFDdc/gQQCmGAIoDtJYRQKGA6uzzhAFKMQRQNKA69WB8gFIMAQRQixFAALUMAQRQyxBAALUMAQRQyxBAALUGCBBAF/8JBEgAEoAEIIAAAkgAEoAEIIAAAgigOwDpvQVIAVKAFCCAAAJIAVKAFCCAAAJIAVKAFCAF6D+ARAASgAQgAUgAEgFIABKABCARgAQgAUgAEgFInswfgfNL6Jcr9lYAAAAASUVORK5CYII=">
<link rel="apple-touch-icon" sizes="512x512" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAANw0lEQVR42u3Y0Q2AMAzE0H53sey/BVvAFEhV/aybIL3EgrUBAEmWEQAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAACXCOB5R0RECEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAERECIAAREQIgABERAiAAERECIAAREQIgABERAiAAERECIAAREQIgABERAiAAERECIAAREQIgABERAjgegFsAHCgCOD6ylpdwIEigKgAOABwoAigKwAaABwoAkgLgAMAB4oAJl5Zyww4UATQrax9BhwoAkhX1lYDDhQBdCtrsQEHigDSlbXegANFAN3K2nCAAMw3XVl7DhCA+XYra9UBAjDfdGUtPEAA5tutrJ0HCMB805W1+QABmG+3spYfIADzTVfWCQABEID5divrCoAACMB805V1C0AABGC+3co6ByAAAjDfdGUdBRAAAZhvt7LuAmwTAZhvurKuA2wTAZivygK2iQDMN1ZZGoBtIgDzTQuAA2CbCMB8uwKgAdgmAjDftAA4ALaJAMy3KwAagG0iAPNNC4ADYJsIwHy7AqAB2CYCMN+0ADgAtokACKArABqAbSIAAkgLgANgmwiAALoCoAHYJgIggLQAOAC2iQAIoCsAGoBtIgACSAuAA2CbCMC56QqABmCbCMChSQuAA2CbCMCV6QqABmCbCMB9SQuAA0AABOC4dAVAAyAAAnBW0gLgABAAAbgpXQHQAAiAAFyTtAA4AARAAE5JVwA0AAeKAByRtAA4AA4UAbggXQHQABwoAnA70gLgADhQBOBwdAVAA3CgCMDJSAuAA+BAEYB70RUADcCBIgCXIi0ADoADRQDORFcANAAHigAciLQAOAAOFAEQwMTjbMGBIgAC4ADAgSIAAqABwIEiAJXl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">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>TRACK // DAILY</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Bebas+Neue&family=DM+Sans:wght@300;400;500&display=swap');

  :root {
    --bg: #0a0a0a;
    --surface: #111111;
    --border: #2a2a2a;
    --border-active: #e8ff47;
    --accent: #e8ff47;
    --accent2: #ff6b35;
    --text: #f0f0f0;
    --muted: #555;
    --checked-bg: #1a1e0a;
    --checked-border: #e8ff47;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    max-width: 480px;
    margin: 0 auto;
    padding: 0;
  }

  /* SETUP SCREEN */
  #setup-screen {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    padding: 40px 24px;
    background: var(--bg);
  }

  .setup-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 48px;
    letter-spacing: 4px;
    color: var(--accent);
    margin-bottom: 8px;
  }

  .setup-sub {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 48px;
  }

  .setup-step {
    margin-bottom: 32px;
  }

  .step-num {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 64px;
    color: #1a1a1a;
    line-height: 1;
    margin-bottom: -8px;
  }

  .step-title {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 12px;
  }

  .step-desc {
    font-size: 13px;
    color: #888;
    line-height: 1.6;
    margin-bottom: 16px;
  }

  .step-desc code {
    background: #1a1a1a;
    border: 1px solid var(--border);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent2);
  }

  input[type="text"] {
    width: 100%;
    background: var(--surface);
    border: 2px solid var(--border);
    color: var(--text);
    padding: 14px 16px;
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    outline: none;
    transition: border-color 0.2s;
  }

  input[type="text"]:focus { border-color: var(--accent); }
  input[type="text"]::placeholder { color: var(--muted); }

  /* FILE DROP ZONE */
  .drop-zone {
    border: 2px dashed var(--border);
    background: var(--surface);
    padding: 28px 20px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    position: relative;
  }

  .drop-zone:hover, .drop-zone.dragover {
    border-color: var(--accent);
    background: #111;
  }

  .drop-zone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }

  .drop-icon {
    font-size: 28px;
    margin-bottom: 10px;
    display: block;
  }

  .drop-label {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    color: var(--muted);
    text-transform: uppercase;
    line-height: 1.8;
  }

  .drop-label strong {
    color: var(--accent);
    display: block;
    font-size: 13px;
  }

  .file-confirm {
    display: none;
    align-items: center;
    gap: 10px;
    background: #0f150a;
    border: 2px solid var(--accent);
    padding: 12px 14px;
    margin-top: 10px;
  }

  .file-confirm-icon { font-size: 18px; }

  .file-confirm-name {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-clear {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 16px;
    cursor: pointer;
    padding: 0 4px;
  }

  .file-clear:hover { color: #ff4444; }

  .col-map {
    background: #0d0d0d;
    border: 1px solid var(--border);
    padding: 14px;
    margin-top: 10px;
    display: none;
  }

  .col-map-title {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
  }

  .col-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }

  .col-key {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--accent);
    width: 110px;
    flex-shrink: 0;
  }

  select {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px 8px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    outline: none;
    cursor: pointer;
  }

  select:focus { border-color: var(--accent); }

  .btn-primary {
    width: 100%;
    padding: 18px;
    background: var(--accent);
    color: #0a0a0a;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px;
    letter-spacing: 3px;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    margin-top: 8px;
  }

  .btn-primary:active { transform: scale(0.98); opacity: 0.9; }

  .btn-secondary {
    background: transparent;
    border: 2px solid var(--border);
    color: var(--muted);
    padding: 12px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    cursor: pointer;
    width: 100%;
    margin-top: 12px;
    transition: border-color 0.2s, color 0.2s;
  }

  .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }

  #error-msg {
    background: #1a0a0a;
    border: 1px solid #ff3b3b;
    color: #ff6b6b;
    padding: 12px 16px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    margin-top: 16px;
    display: none;
  }

  /* MAIN APP */
  #app-screen {
    display: none;
    flex-direction: column;
    min-height: 100vh;
  }

  /* HEADER DASHBOARD */
  .dashboard {
    background: var(--surface);
    border-bottom: 3px solid var(--accent);
    padding: 24px 20px 20px;
    position: relative;
  }

  .dashboard::before {
    content: '';
    position: absolute;
    top: -40px;
    right: -40px;
    width: 120px;
    height: 120px;
    background: var(--accent);
    opacity: 0.04;
    border-radius: 50%;
  }

  .dash-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    position: relative;
    z-index: 10;
  }

  .app-wordmark {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 28px;
    letter-spacing: 3px;
    color: var(--accent);
    line-height: 1;
  }

  .app-date-badge {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
    color: var(--bg);
    background: var(--accent);
    padding: 4px 8px;
    text-transform: uppercase;
  }

  .info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .info-card {
    background: var(--bg);
    border: 2px solid var(--border);
    padding: 12px 14px;
    position: relative;
  }

  .info-card.full-width {
    grid-column: 1 / -1;
  }

  .info-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .info-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    color: var(--text);
    line-height: 1;
  }

  .info-value.accent { color: var(--accent); }
  .info-value.sm { font-size: 22px; }

  .info-unit {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    margin-top: 2px;
  }

  .loading-pulse {
    display: inline-block;
    width: 60px;
    height: 28px;
    background: #1a1a1a;
    animation: pulse 1.2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.8; }
  }

  /* CHECKLIST */
  .checklist-section {
    flex: 1;
    padding: 20px;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .section-title {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
  }

  .section-line {
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .progress-bar-wrap {
    height: 2px;
    background: var(--border);
    margin-bottom: 20px;
    position: relative;
  }

  .progress-bar-fill {
    height: 100%;
    background: var(--accent);
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    width: 0%;
  }

  .tiles-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .tile {
    background: var(--surface);
    border: 3px solid var(--border);
    padding: 20px 16px;
    cursor: pointer;
    position: relative;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    min-height: 130px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    overflow: hidden;
  }

  .tile::after {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--accent);
    opacity: 0;
    transition: opacity 0.15s;
  }

  .tile:active::after { opacity: 0.05; }

  .tile.checked {
    background: var(--checked-bg);
    border-color: var(--accent);
  }

  .tile.checked .tile-icon { color: var(--accent); }
  .tile.checked .tile-label { color: var(--accent); }

  .tile-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .tile-icon {
    font-size: 24px;
    color: var(--muted);
    transition: color 0.2s;
    line-height: 1;
  }

  .tile-checkbox {
    width: 22px;
    height: 22px;
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .tile.checked .tile-checkbox {
    background: var(--accent);
    border-color: var(--accent);
  }

  .check-mark {
    display: none;
    width: 12px;
    height: 8px;
    border-bottom: 2px solid #0a0a0a;
    border-left: 2px solid #0a0a0a;
    transform: rotate(-45deg) translateY(-2px);
  }

  .tile.checked .check-mark { display: block; }

  .tile-bottom {}

  .tile-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    transition: color 0.2s;
    margin-bottom: 4px;
    line-height: 1.4;
  }

  .tile-sublabel {
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    color: #333;
  }

  .tile.checked .tile-sublabel { color: #5a6820; }

  /* STREAK + FOOTER */
  .streak-bar {
    padding: 16px 20px;
    background: var(--surface);
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .streak-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }

  .streak-val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    color: var(--accent);
    letter-spacing: 1px;
  }

  .sync-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 6px 12px;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .sync-btn:hover { border-color: var(--accent); color: var(--accent); }
  .sync-btn.syncing { color: var(--accent); border-color: var(--accent); }

  .reset-link {
    display: block;
    text-align: center;
    padding: 12px;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    color: #2a2a2a;
    cursor: pointer;
    text-decoration: none;
  }

  .reset-link:hover { color: var(--muted); }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--accent);
    color: #0a0a0a;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    padding: 10px 20px;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 100;
    white-space: nowrap;
  }

  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Status dot */
  .status-dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--muted);
    margin-right: 6px;
  }

  .status-dot.live { background: #4ade80; animation: blink 2s infinite; }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .conn-status {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    color: var(--muted);
    display: flex;
    align-items: center;
    padding: 8px 20px;
  }

  /* DEMO MODE BADGE */
  .demo-badge {
    background: #1a1000;
    border: 1px solid #ff6b35;
    color: #ff6b35;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    padding: 4px 8px;
    text-transform: uppercase;
  }

  /* Animations */
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .tile { animation: slideUp 0.4s ease both; }
  .tile:nth-child(1) { animation-delay: 0.05s; }
  .tile:nth-child(2) { animation-delay: 0.1s; }
  .tile:nth-child(3) { animation-delay: 0.15s; }
  .tile:nth-child(4) { animation-delay: 0.2s; }

  @media (prefers-reduced-motion: reduce) {
    .tile { animation: none; }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HAMBURGER + SIDE DRAWER
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .hamburger {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    -webkit-tap-highlight-color: transparent;
    position: relative;
    z-index: 100;
    pointer-events: all;
  }
  .hamburger span {
    display: block;
    width: 22px;
    height: 2px;
    background: var(--accent);
    transition: all 0.3s ease;
  }
  .hamburger.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
  .hamburger.open span:nth-child(2) { opacity: 0; }
  .hamburger.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

  .drawer-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    z-index: 9998;
    backdrop-filter: blur(2px);
  }
  .drawer-overlay.open { display: block; }

  .drawer {
    position: fixed;
    top: 0; right: -100%;
    width: 80%;
    max-width: 320px;
    height: 100%;
    background: var(--surface);
    border-left: 2px solid var(--border);
    z-index: 9999;
    transition: right 0.3s cubic-bezier(0.4,0,0.2,1);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }
  .drawer.open { right: 0; }

  .drawer-header {
    padding: 32px 24px 20px;
    border-bottom: 1px solid var(--border);
  }
  .drawer-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    letter-spacing: 3px;
    color: var(--accent);
  }
  .drawer-sub {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 4px;
  }

  .drawer-nav {
    padding: 16px 0;
    flex: 1;
  }
  .drawer-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 16px 24px;
    cursor: pointer;
    border-left: 3px solid transparent;
    transition: all 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .drawer-item:hover, .drawer-item.active {
    background: rgba(232,255,71,0.05);
    border-left-color: var(--accent);
  }
  .drawer-item.active .drawer-item-label { color: var(--accent); }
  .drawer-item-icon { font-size: 20px; width: 24px; text-align: center; }
  .drawer-item-label {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    transition: color 0.15s;
  }

  .drawer-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border);
  }
  .drawer-reset {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    color: #2a2a2a;
    cursor: pointer;
    background: none;
    border: none;
    text-transform: uppercase;
    transition: color 0.2s;
  }
  .drawer-reset:hover { color: #ff4444; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE SYSTEM
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .page { display: none; flex-direction: column; min-height: 100vh; }
  .page.active { display: flex; }

  .page-header {
    background: var(--surface);
    border-bottom: 3px solid var(--accent);
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .page-back {
    background: none;
    border: none;
    color: var(--accent);
    font-size: 20px;
    cursor: pointer;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
  }
  .page-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 24px;
    letter-spacing: 2px;
    color: var(--text);
    flex: 1;
  }
  .page-subtitle {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 2px;
  }
  .page-body { flex: 1; overflow-y: auto; padding: 20px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MEASUREMENTS ROADMAP PAGE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .month-card {
    background: var(--surface);
    border: 2px solid var(--border);
    margin-bottom: 12px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .month-card.current-month { border-color: var(--accent); }

  .month-card-header {
    padding: 12px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  .month-card.current-month .month-card-header { background: rgba(232,255,71,0.05); }

  .month-name {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    letter-spacing: 2px;
    color: var(--text);
  }
  .month-card.current-month .month-name { color: var(--accent); }

  .month-badge {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    letter-spacing: 1px;
    background: var(--accent);
    color: #0a0a0a;
    padding: 2px 7px;
    text-transform: uppercase;
  }
  .month-weight {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
  }

  .month-measurements {
    display: none;
    grid-template-columns: 1fr 1fr;
    gap: 1px;
    background: var(--border);
    border-top: 1px solid var(--border);
  }
  .month-card.expanded .month-measurements { display: grid; }

  .meas-cell {
    background: var(--bg);
    padding: 12px 14px;
  }
  .meas-cell-label {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .meas-cell-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22px;
    color: var(--text);
  }
  .meas-cell.current-month-cell .meas-cell-value { color: var(--accent); }

  .chevron {
    font-size: 12px;
    color: var(--muted);
    transition: transform 0.2s;
  }
  .month-card.expanded .chevron { transform: rotate(180deg); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ACTUAL RESULTS PAGE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .results-month-select {
    background: var(--surface);
    border: 2px solid var(--border);
    padding: 16px 20px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .results-month-select label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    flex-shrink: 0;
  }
  .results-month-select select {
    flex: 1;
    background: var(--bg);
    border: 1px solid var(--border);
    padding: 8px 10px;
  }

  .comparison-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1px;
    background: var(--border);
    border: 2px solid var(--border);
    margin-bottom: 20px;
  }
  .comp-cell {
    background: var(--surface);
    padding: 14px 14px 12px;
  }
  .comp-cell-label {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 6px;
  }
  .comp-target {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    color: var(--muted);
    line-height: 1;
  }
  .comp-actual-wrap {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 6px;
  }
  .comp-actual-input {
    width: 70px;
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px 8px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 18px;
    outline: none;
    text-align: center;
  }
  .comp-actual-input:focus { border-color: var(--accent); }
  .comp-diff {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
  }
  .comp-diff.better { color: #4ade80; }
  .comp-diff.worse { color: #ff6b6b; }
  .comp-diff.neutral { color: var(--muted); }

  .comp-header-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1px;
    background: var(--border);
    border: 2px solid var(--border);
    border-bottom: none;
  }
  .comp-header-cell {
    background: #0d0d0d;
    padding: 8px 14px;
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }
  .comp-header-cell.right { color: var(--accent); }

  .results-save-btn {
    width: 100%;
    padding: 16px;
    background: var(--accent);
    color: #0a0a0a;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 20px;
    letter-spacing: 3px;
    cursor: pointer;
    transition: opacity 0.2s;
    margin-top: 4px;
  }
  .results-save-btn:active { opacity: 0.85; }

  .results-history {
    margin-top: 24px;
  }
  .results-history-title {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .results-history-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .history-row {
    display: flex;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
    gap: 8px;
  }
  .history-month {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 16px;
    color: var(--muted);
    width: 60px;
    flex-shrink: 0;
  }
  .history-measurements {
    flex: 1;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .history-meas {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    color: var(--muted);
  }
  .history-meas span { color: var(--text); }
  .history-delete {
    background: none;
    border: none;
    color: #2a2a2a;
    cursor: pointer;
    font-size: 14px;
    padding: 4px;
    transition: color 0.2s;
  }
  .history-delete:hover { color: #ff4444; }

  .no-results {
    text-align: center;
    padding: 40px 20px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 1px;
  }

</style>
</head>
<body>

<!-- DRAWER OVERLAY -->
<div class="drawer-overlay" id="drawer-overlay" onclick="closeDrawer()"></div>

<!-- SIDE DRAWER -->
<div class="drawer" id="drawer">
  <div class="drawer-header">
    <div class="drawer-logo">TRACK //</div>
    <div class="drawer-sub">Weight Loss Tracker</div>
  </div>
  <nav class="drawer-nav">
    <div class="drawer-item active" id="nav-daily" onclick="navigateTo('daily')">
      <span class="drawer-item-icon">ğŸ“‹</span>
      <span class="drawer-item-label">Daily Checklist</span>
    </div>
    <div class="drawer-item" id="nav-roadmap" onclick="navigateTo('roadmap')">
      <span class="drawer-item-icon">ğŸ“</span>
      <span class="drawer-item-label">Measurements Roadmap</span>
    </div>
    <div class="drawer-item" id="nav-results" onclick="navigateTo('results')">
      <span class="drawer-item-icon">ğŸ“Š</span>
      <span class="drawer-item-label">My Actual Results</span>
    </div>
  </nav>
  <div class="drawer-footer">
    <button class="drawer-reset" onclick="confirmReset()">âš  Reset &amp; reload CSV</button>
  </div>
</div>

<!-- SETUP SCREEN -->
<div id="setup-screen">
  <div class="setup-logo">TRACK //</div>
  <div class="setup-sub">Weight Loss Daily Tracker</div>

  <div class="setup-step">
    <div class="step-num">01</div>
    <div class="step-title">Monthly Roadmap CSV</div>
    <div class="step-desc">
      Export your <code>Monthly_Roadmap</code> tab as a CSV from Google Sheets â†’ File â†’ Download â†’ CSV. Expected columns: <code>Month</code>, <code>Sun-Fri Cals</code>, <code>Sat Buffer</code>, <code>Step Goal</code>, <code>Target Weight</code>
    </div>
    <div class="drop-zone" id="drop-roadmap" ondragover="onDragOver(event,'roadmap')" ondragleave="onDragLeave('roadmap')" ondrop="onDrop(event,'roadmap')">
      <input type="file" accept=".csv,text/csv" onchange="onFileSelect(event,'roadmap')">
      <span class="drop-icon">ğŸ“‹</span>
      <div class="drop-label"><strong>Monthly_Roadmap.csv</strong>Drag & drop or tap to browse</div>
    </div>
    <div class="file-confirm" id="confirm-roadmap">
      <span class="file-confirm-icon">âœ…</span>
      <span class="file-confirm-name" id="name-roadmap"></span>
      <button class="file-clear" onclick="clearFile('roadmap')">âœ•</button>
    </div>
    <div class="col-map" id="colmap-roadmap">
      <div class="col-map-title">Map your columns â†’</div>
      <div class="col-row"><span class="col-key">Month col</span><select id="map-month"></select></div>
      <div class="col-row"><span class="col-key">Sun-Fri Cals</span><select id="map-cals"></select></div>
      <div class="col-row"><span class="col-key">Sat Buffer</span><select id="map-sat"></select></div>
      <div class="col-row"><span class="col-key">Step Goal</span><select id="map-steps"></select></div>
      <div class="col-row"><span class="col-key">Target Weight</span><select id="map-weight"></select></div>
    </div>
  </div>

  <div class="setup-step">
    <div class="step-num">02</div>
    <div class="step-title">Daily Log CSV <span style="color:var(--muted);font-size:10px;">(optional)</span></div>
    <div class="step-desc">
      Export your <code>Daily_Log</code> tab as CSV. This is used to count your past perfect days streak. You can skip this â€” the app will start a fresh log.
    </div>
    <div class="drop-zone" id="drop-log" ondragover="onDragOver(event,'log')" ondragleave="onDragLeave('log')" ondrop="onDrop(event,'log')">
      <input type="file" accept=".csv,text/csv" onchange="onFileSelect(event,'log')">
      <span class="drop-icon">ğŸ“…</span>
      <div class="drop-label"><strong>Daily_Log.csv</strong>Drag & drop or tap to browse</div>
    </div>
    <div class="file-confirm" id="confirm-log">
      <span class="file-confirm-icon">âœ…</span>
      <span class="file-confirm-name" id="name-log"></span>
      <button class="file-clear" onclick="clearFile('log')">âœ•</button>
    </div>
  </div>

  <button class="btn-primary" onclick="connectCSV()">LOAD DATA</button>
  <button class="btn-secondary" onclick="loadDemoMode()">â†— LAUNCH IN DEMO MODE</button>

  <div id="error-msg"></div>
</div>

<!-- MAIN APP -->
<div id="app-screen">

  <!-- â•â• PAGE: DAILY â•â• -->
  <div class="page active" id="page-daily">
  <div class="dashboard">
    <div class="dash-top">
      <div class="app-wordmark">TRACK //</div>
      <div style="display:flex;align-items:center;gap:10px;">
        <span id="demo-badge" class="demo-badge" style="display:none">DEMO</span>
        <div class="app-date-badge" id="date-display">--</div>
        <button class="hamburger" id="hamburger-btn" onclick="toggleDrawer()" aria-label="Menu">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>

    <div class="info-grid">
      <div class="info-card">
        <div class="info-label">Cal Limit</div>
        <div class="info-value accent" id="cal-limit"><span class="loading-pulse"></span></div>
        <div class="info-unit">KCAL TARGET</div>
      </div>
      <div class="info-card">
        <div class="info-label">Step Goal</div>
        <div class="info-value" id="step-goal"><span class="loading-pulse"></span></div>
        <div class="info-unit">STEPS / DAY</div>
      </div>
      <div class="info-card full-width">
        <div class="info-label">Monthly Target Weight</div>
        <div class="info-value sm" id="target-weight"><span class="loading-pulse"></span></div>
        <div class="info-unit">LBS BY END OF MONTH</div>
      </div>
    </div>
  </div>

  <div class="conn-status">
    <span class="status-dot" id="status-dot"></span>
    <span id="status-text">Connecting...</span>
  </div>

  <div class="checklist-section">
    <div class="section-header">
      <span class="section-title">Today's Checklist</span>
      <div class="section-line"></div>
    </div>
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="progress-bar"></div>
    </div>

    <div class="tiles-grid">
      <div class="tile" id="tile-cals" onclick="toggleTile('cals')">
        <div class="tile-top">
          <div class="tile-icon">ğŸ”¥</div>
          <div class="tile-checkbox"><div class="check-mark"></div></div>
        </div>
        <div class="tile-bottom">
          <div class="tile-label">Within<br>Cals</div>
          <div class="tile-sublabel">Under daily limit</div>
        </div>
      </div>

      <div class="tile" id="tile-steps" onclick="toggleTile('steps')">
        <div class="tile-top">
          <div class="tile-icon">ğŸ‘Ÿ</div>
          <div class="tile-checkbox"><div class="check-mark"></div></div>
        </div>
        <div class="tile-bottom">
          <div class="tile-label">Hit<br>Steps</div>
          <div class="tile-sublabel">Daily step goal</div>
        </div>
      </div>

      <div class="tile" id="tile-protein" onclick="toggleTile('protein')">
        <div class="tile-top">
          <div class="tile-icon">ğŸ’ª</div>
          <div class="tile-checkbox"><div class="check-mark"></div></div>
        </div>
        <div class="tile-bottom">
          <div class="tile-label">Hit<br>Protein</div>
          <div class="tile-sublabel">180g+ target</div>
        </div>
      </div>

      <div class="tile" id="tile-supps" onclick="toggleTile('supps')">
        <div class="tile-top">
          <div class="tile-icon">ğŸ’Š</div>
          <div class="tile-checkbox"><div class="check-mark"></div></div>
        </div>
        <div class="tile-bottom">
          <div class="tile-label">Taken<br>Supps</div>
          <div class="tile-sublabel">Multi + Fiber + Vit D</div>
        </div>
      </div>
    </div>
  </div>

  <div class="streak-bar">
    <div>
      <div class="streak-label">Perfect Days</div>
      <div class="streak-val" id="streak-val">â€“</div>
    </div>
    <button class="sync-btn" id="sync-btn" onclick="exportLog()">â†“ EXPORT LOG</button>
  </div>

  <a class="reset-link" onclick="navigateTo('roadmap')" style="color:var(--muted);opacity:0.5;">ğŸ“ View measurements roadmap</a>
  </div><!-- end page-daily -->

  <!-- â•â• PAGE: MEASUREMENTS ROADMAP â•â• -->
  <div class="page" id="page-roadmap">
    <div class="page-header">
      <button class="page-back" onclick="navigateTo('daily')">â†</button>
      <div>
        <div class="page-title">Measurements Roadmap</div>
        <div class="page-subtitle">Monthly targets from your CSV</div>
      </div>
      <button class="hamburger" style="margin-left:auto" onclick="toggleDrawer()" aria-label="Menu">
        <span style="background:var(--accent)"></span>
        <span style="background:var(--accent)"></span>
        <span style="background:var(--accent)"></span>
      </button>
    </div>
    <div class="page-body" id="roadmap-page-body">
      <div class="no-results">Upload your CSV to see the roadmap.</div>
    </div>
  </div>

  <!-- â•â• PAGE: ACTUAL RESULTS â•â• -->
  <div class="page" id="page-results">
    <div class="page-header">
      <button class="page-back" onclick="navigateTo('daily')">â†</button>
      <div>
        <div class="page-title">My Actual Results</div>
        <div class="page-subtitle">Log &amp; compare vs targets</div>
      </div>
      <button class="hamburger" style="margin-left:auto" onclick="toggleDrawer()" aria-label="Menu">
        <span style="background:var(--accent)"></span>
        <span style="background:var(--accent)"></span>
        <span style="background:var(--accent)"></span>
      </button>
    </div>
    <div class="page-body">

      <div class="results-month-select">
        <label>Month</label>
        <select id="results-month-picker" onchange="renderResultsForm()"></select>
      </div>

      <div class="comp-header-row">
        <div class="comp-header-cell">Target</div>
        <div class="comp-header-cell right">Actual â†’ Diff</div>
      </div>
      <div class="comparison-grid" id="comparison-grid">
        <!-- filled by JS -->
      </div>

      <button class="results-save-btn" onclick="saveResults()">SAVE THIS MONTH</button>

      <div class="results-history">
        <div class="results-history-title">Saved Results</div>
        <div id="results-history-list"></div>
      </div>
    </div>
  </div>

</div><!-- end app-screen -->

<div class="toast" id="toast"></div>

<script>
// â€”â€”â€” SAFE STORAGE (falls back to memory if localStorage blocked) â€”â€”â€”
const memStore = {};
const store = {
  get(k) { try { const v = localStorage.getItem(k); return v; } catch(e) { return memStore[k] ?? null; } },
  set(k, v) { try { localStorage.setItem(k, v); } catch(e) { memStore[k] = v; } },
  remove(k) { try { localStorage.removeItem(k); } catch(e) { delete memStore[k]; } }
};

// â€”â€”â€” STATE â€”â€”â€”
let checks = { cals: false, steps: false, protein: false, supps: false };
let todayKey = getTodayKey();
let csvFiles = { roadmap: null, log: null };
let roadmapRows = [];  // parsed rows from roadmap CSV
let logRows = [];      // parsed rows from daily log CSV
let colMap = {};       // column mappings for roadmap

function getTodayKey() {
  return new Date().toISOString().split('T')[0];
}
function getTodayLabel() {
  return new Date().toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric' }).toUpperCase();
}
function isSaturday() { return new Date().getDay() === 6; }

// â€”â€”â€” CSV PARSING â€”â€”â€”
function parseCSV(text) {
  const lines = text.trim().split('\n');
  return lines.map(line => {
    // Handle quoted fields
    const cells = [];
    let cur = '', inQ = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"') { inQ = !inQ; }
      else if (ch === ',' && !inQ) { cells.push(cur.trim()); cur = ''; }
      else { cur += ch; }
    }
    cells.push(cur.trim());
    return cells;
  });
}

// â€”â€”â€” FILE HANDLING â€”â€”â€”
function onDragOver(e, key) {
  e.preventDefault();
  document.getElementById('drop-'+key).classList.add('dragover');
}
function onDragLeave(key) {
  document.getElementById('drop-'+key).classList.remove('dragover');
}
function onDrop(e, key) {
  e.preventDefault();
  onDragLeave(key);
  const file = e.dataTransfer.files[0];
  if (file) handleFile(file, key);
}
function onFileSelect(e, key) {
  const file = e.target.files[0];
  if (file) handleFile(file, key);
}
function clearFile(key) {
  csvFiles[key] = null;
  document.getElementById('confirm-'+key).style.display = 'none';
  document.getElementById('drop-'+key).style.display = 'block'; // keep drop zone visible
  if (key === 'roadmap') {
    document.getElementById('colmap-roadmap').style.display = 'none';
  }
  showError('');
}

function handleFile(file, key) {
  if (!file.name.endsWith('.csv') && file.type !== 'text/csv') {
    showError('Please upload a .csv file.');
    return;
  }
  const reader = new FileReader();
  reader.onload = (e) => {
    const text = e.target.result;
    const rows = parseCSV(text);
    csvFiles[key] = { name: file.name, rows };

    // Show confirm badge
    document.getElementById('name-'+key).textContent = file.name;
    document.getElementById('confirm-'+key).style.display = 'flex';

    if (key === 'roadmap') {
      buildColumnMapper(rows);
    }
    showError('');
  };
  reader.readAsText(file);
}

function buildColumnMapper(rows) {
  if (!rows.length) return;
  // Find header row (first row with multiple populated cells)
  const headerRow = rows[0];
  const opts = headerRow.map((h, i) => `<option value="${i}">${h || 'Col '+(i+1)}</option>`).join('');

  ['map-month','map-cals','map-sat','map-steps','map-weight'].forEach(id => {
    document.getElementById(id).innerHTML = opts;
  });

  // Auto-detect column positions
  headerRow.forEach((h, i) => {
    const l = h.toLowerCase();
    if (l.includes('date') || l === 'month') document.getElementById('map-month').value = i;
    else if (l.includes('sun') || (l.includes('fri') && l.includes('cal'))) document.getElementById('map-cals').value = i;
    else if (l.includes('sat') && l.includes('buf')) document.getElementById('map-sat').value = i;
    else if (l.includes('step')) document.getElementById('map-steps').value = i;
    else if (l.includes('target weight') || l === 'target weight') document.getElementById('map-weight').value = i;
    else if (l.includes('weight') && !l.includes('target')) { /* skip non-target weight cols */ }
  });

  document.getElementById('colmap-roadmap').style.display = 'block';
}

// â€”â€”â€” CONNECT â€”â€”â€”
function connectCSV() {
  if (!csvFiles.roadmap) { showError('Please upload your Monthly_Roadmap CSV.'); return; }

  colMap = {
    month: parseInt(document.getElementById('map-month').value),
    cals: parseInt(document.getElementById('map-cals').value),
    sat: parseInt(document.getElementById('map-sat').value),
    steps: parseInt(document.getElementById('map-steps').value),
    weight: parseInt(document.getElementById('map-weight').value),
  };

  roadmapRows = csvFiles.roadmap.rows.slice(1); // skip header
  if (csvFiles.log) logRows = csvFiles.log.rows.slice(1);

  // Persist roadmap data to localStorage for session
  // Save header row too so measurement columns can be detected on other pages
  const roadmapHeaders = csvFiles.roadmap.rows[0] || [];
  try {
    store.set('tracker_roadmap', JSON.stringify({ v: 2, rows: roadmapRows, colMap, headers: roadmapHeaders }));
    store.set('tracker_log', JSON.stringify(logRows));
  } catch(e) {}

  launchApp(false);
}

function loadDemoMode() {
  store.remove('tracker_roadmap');
  launchApp(true);
}

function launchApp(isDemo) {
  document.getElementById('setup-screen').style.display = 'none';
  document.getElementById('app-screen').style.display = 'flex';
  document.getElementById('date-display').textContent = getTodayLabel();

  if (isDemo) {
    document.getElementById('demo-badge').style.display = 'inline-block';
    loadDemoData();
  } else {
    loadRoadmapDisplay();
    setStatus('live');
  }
  loadChecks();
  computeStreak();
}

// â€”â€”â€” ROADMAP DISPLAY â€”â€”â€”
function loadRoadmapDisplay() {
  // Try from memory first, then localStorage
  if (!roadmapRows.length) {
    try {
      const saved = JSON.parse(store.get('tracker_roadmap') || '{}');
      roadmapRows = saved.rows || [];
      colMap = saved.colMap || {};
    } catch(e) {}  }

  if (!roadmapRows.length) { setDashFallback(); return; }

  const today = new Date();
  const todayMonth = today.getMonth() + 1; // 1-12
  const todayYear = today.getFullYear();

  // Try to match row by parsing the date cell (supports DD/MM/YYYY, MM/DD/YYYY, YYYY-MM-DD, month names)
  function extractMonthYear(val) {
    if (!val) return null;
    val = val.trim();
    // DD/MM/YYYY or MM/DD/YYYY
    const slashMatch = val.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
    if (slashMatch) {
      const year = parseInt(slashMatch[3]);
      // Assume DD/MM/YYYY if first number > 12, else try to detect
      // Since user's data is DD/MM/YYYY format, use that
      const month = parseInt(slashMatch[2]);
      const day = parseInt(slashMatch[1]);
      // If month part > 12, it's actually DD/MM/YYYY swapped â€” use position 2 as month
      return { month: month <= 12 ? month : day, year };
    }
    // YYYY-MM-DD
    const isoMatch = val.match(/^(\d{4})-(\d{2})-(\d{2})$/);
    if (isoMatch) return { month: parseInt(isoMatch[2]), year: parseInt(isoMatch[1]) };
    // Month name
    const monthNames = ['january','february','march','april','may','june','july','august','september','october','november','december'];
    const lower = val.toLowerCase();
    const idx = monthNames.findIndex(m => lower.includes(m));
    if (idx > -1) {
      const yearMatch = val.match(/\d{4}/);
      return { month: idx + 1, year: yearMatch ? parseInt(yearMatch[0]) : todayYear };
    }
    return null;
  }

  let row = roadmapRows.find(r => {
    const parsed = extractMonthYear(r[colMap.month]);
    return parsed && parsed.month === todayMonth && parsed.year === todayYear;
  });

  if (!row) {
    // No exact month match â€” use the next upcoming row (nearest future date)
    const todayTime = new Date(todayYear, todayMonth - 1, 1).getTime();
    const upcoming = roadmapRows
      .map(r => ({ r, parsed: extractMonthYear(r[colMap.month]) }))
      .filter(({ parsed }) => parsed && new Date(parsed.year, parsed.month - 1, 1).getTime() >= todayTime)
      .sort((a, b) => new Date(a.parsed.year, a.parsed.month - 1) - new Date(b.parsed.year, b.parsed.month - 1));
    row = upcoming.length ? upcoming[0].r : roadmapRows[0];
  }

  if (!row) { setDashFallback(); return; }

  const calVal = isSaturday() ? row[colMap.sat] : row[colMap.cals];
  const stepVal = row[colMap.steps];
  const weightVal = row[colMap.weight];

  document.getElementById('cal-limit').textContent = formatNum(calVal) || 'â€”';
  document.getElementById('step-goal').textContent = formatNum(stepVal) || 'â€”';
  document.getElementById('target-weight').textContent = weightVal ? weightVal.replace(/lbs?/i,'').trim()+'lbs' : 'â€”';
}

function formatNum(val) {
  if (!val) return '';
  const n = parseInt(val.toString().replace(/[^0-9]/g,''));
  if (!n) return val;
  return n.toLocaleString();
}

function setDashFallback() {
  document.getElementById('cal-limit').textContent = 'â€”';
  document.getElementById('step-goal').textContent = 'â€”';
  document.getElementById('target-weight').textContent = 'â€”';
}

function loadDemoData() {
  setTimeout(() => {
    document.getElementById('cal-limit').textContent = isSaturday() ? '2,000' : '1,650';
    document.getElementById('step-goal').textContent = '10,000';
    document.getElementById('target-weight').textContent = '195lbs';
    setStatus('demo');
  }, 400);
}

// â€”â€”â€” CHECKS â€”â€”â€”
function loadChecks() {
  try {
    const saved = JSON.parse(store.get('tracker_checks') || '{}');
    if (saved.date === todayKey) {
      checks = saved.checks || checks;
    } else {
      checks = { cals: false, steps: false, protein: false, supps: false };
      saveChecks();
    }
  } catch(e) {}
  renderTiles();
}

function saveChecks() {
  store.set('tracker_checks', JSON.stringify({ date: todayKey, checks }));
}

function toggleTile(key) {
  checks[key] = !checks[key];
  saveChecks();
  renderTiles();
  showToast(checks[key] ? 'âœ“ Logged' : 'Unchecked');
  if (Object.values(checks).every(Boolean)) {
    updateStreak();
    showToast('ğŸ”¥ Perfect day!');
  }
}

function renderTiles() {
  ['cals','steps','protein','supps'].forEach(k => {
    document.getElementById('tile-'+k).classList.toggle('checked', checks[k]);
  });
  updateProgress();
}

function updateProgress() {
  const count = Object.values(checks).filter(Boolean).length;
  document.getElementById('progress-bar').style.width = (count/4*100)+'%';
}

// â€”â€”â€” EXPORT LOG â€”â€”â€”
function exportLog() {
  // Build full log: existing + today's entry
  const header = 'Date,Within Cals,Hit Steps,Hit Protein,Taken Supps';
  const existingRows = logRows.map(r => r.join(',')).join('\n');
  const todayRow = [
    todayKey,
    checks.cals ? 'YES':'NO',
    checks.steps ? 'YES':'NO',
    checks.protein ? 'YES':'NO',
    checks.supps ? 'YES':'NO'
  ].join(',');

  const csvContent = [header, existingRows, todayRow].filter(Boolean).join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `Daily_Log_${todayKey}.csv`;
  a.click();
  URL.revokeObjectURL(url);
  showToast('âœ“ Log exported!');
  updateStreak();
}

// â€”â€”â€” STREAK â€”â€”â€”
function computeStreak() {
  // Count consecutive perfect days from log
  try {
    const saved = JSON.parse(store.get('tracker_log') || '[]');
    if (saved.length) logRows = saved;
  } catch(e) {}

  const streak = parseInt(store.get('tracker_streak') || '0');
  document.getElementById('streak-val').textContent = streak + ' DAYS';
}

function updateStreak() {
  const lastDate = store.get('tracker_streak_date');
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate()-1);
  const yKey = yesterday.toISOString().split('T')[0];
  let streak = parseInt(store.get('tracker_streak') || '0');
  if (lastDate === yKey) { streak++; }
  else if (lastDate !== todayKey) { streak = 1; }
  store.set('tracker_streak', streak);
  store.set('tracker_streak_date', todayKey);
  document.getElementById('streak-val').textContent = streak + ' DAYS';
}

// â€”â€”â€” UI HELPERS â€”â€”â€”
function setStatus(state) {
  const dot = document.getElementById('status-dot');
  const txt = document.getElementById('status-text');
  if (state === 'live') {
    dot.className = 'status-dot live';
    txt.textContent = 'Loaded from CSV';
  } else if (state === 'demo') {
    dot.className = 'status-dot';
    dot.style.background = '#ff6b35';
    txt.textContent = 'Demo mode â€” sample data';
  } else {
    dot.className = 'status-dot';
    txt.textContent = 'No data loaded';
  }
}

let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
}

function showError(msg) {
  const el = document.getElementById('error-msg');
  el.textContent = msg;
  el.style.display = msg ? 'block' : 'none';
}

function confirmReset() {
  if (confirm('Clear loaded data and return to setup?')) {
    store.remove('tracker_roadmap');
    store.remove('tracker_log');
    location.reload();
  }
}

// â€”â€”â€” INIT â€”â€”â€”
(function init() {
  // If we have saved roadmap data, skip setup
  try {
    const saved = JSON.parse(store.get('tracker_roadmap') || '{}');
    if (saved.rows && saved.rows.length && saved.v === 2) {
      roadmapRows = saved.rows;
      colMap = saved.colMap;
      launchApp(false);
      return;
    }
  } catch(e) {}

  // Auto-reset at midnight
  setInterval(() => {
    const newKey = getTodayKey();
    if (newKey !== todayKey) {
      todayKey = newKey;
      checks = { cals: false, steps: false, protein: false, supps: false };
      saveChecks();
      renderTiles();
      document.getElementById('date-display').textContent = getTodayLabel();
      loadRoadmapDisplay();
    }
  }, 60000);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function navigateTo(page) {
  closeDrawer();
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelectorAll('.drawer-item').forEach(i => i.classList.remove('active'));
  const navEl = document.getElementById('nav-' + page);
  if (navEl) navEl.classList.add('active');

  if (page === 'roadmap') renderRoadmapPage();
  if (page === 'results') renderResultsPage();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleDrawer() {
  const open = document.getElementById('drawer').classList.toggle('open');
  document.getElementById('drawer-overlay').classList.toggle('open', open);
  const hbtn = document.getElementById('hamburger-btn');
  if (hbtn) hbtn.classList.toggle('open', open);
}
function closeDrawer() {
  document.getElementById('drawer').classList.remove('open');
  document.getElementById('drawer-overlay').classList.remove('open');
  const hbtn = document.getElementById('hamburger-btn');
  if (hbtn) hbtn.classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED: extractMonthYear (global scope)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function extractMonthYearGlobal(val) {
  if (!val) return null;
  val = val.trim();
  const slashMatch = val.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
  if (slashMatch) {
    const year = parseInt(slashMatch[3]);
    const month = parseInt(slashMatch[2]);
    const day = parseInt(slashMatch[1]);
    return { month: month <= 12 ? month : day, year };
  }
  const isoMatch = val.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if (isoMatch) return { month: parseInt(isoMatch[2]), year: parseInt(isoMatch[1]) };
  const monthNames = ['january','february','march','april','may','june','july','august','september','october','november','december'];
  const lower = val.toLowerCase();
  const idx = monthNames.findIndex(m => lower.includes(m));
  if (idx > -1) {
    const yearMatch = val.match(/\d{4}/);
    return { month: idx + 1, year: yearMatch ? parseInt(yearMatch[0]) : new Date().getFullYear() };
  }
  return null;
}

function monthLabel(parsed) {
  if (!parsed) return 'â€”';
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return months[parsed.month - 1] + ' ' + parsed.year;
}

function getColIndices() {
  // Measurement columns â€” auto-detect from headers
  if (!roadmapRows.length) return {};
  // We stored colMap for cals/steps/weight. Measurements are separate columns.
  // Detect from the first full row (row 0 is actually header row stored separately)
  // roadmapRows = rows AFTER header â€” so we need to look at csvFiles header
  let headers = [];
  try {
    const saved = JSON.parse(store.get('tracker_roadmap') || '{}');
    headers = saved.headers || [];
  } catch(e) {}
  if (!headers.length) return {};

  const find = (terms) => headers.findIndex(h => terms.some(t => h.toLowerCase().includes(t)));

  return {
    waist:  find(['waist','pants']),
    belly:  find(['belly','button','navel']),
    hips:   find(['hip']),
    chest:  find(['chest','man','boob','pec']),
    weight: colMap.weight >= 0 ? colMap.weight : find(['target weight','weight']),
    month:  colMap.month >= 0 ? colMap.month : find(['date','month']),
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROADMAP PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRoadmapPage() {
  const body = document.getElementById('roadmap-page-body');
  if (!roadmapRows.length) {
    body.innerHTML = '<div class="no-results">Upload your Monthly_Roadmap CSV to see targets.</div>';
    return;
  }

  const cols = getColIndices();
  const today = new Date();
  const todayMonth = today.getMonth() + 1;
  const todayYear = today.getFullYear();

  let html = '';
  roadmapRows.forEach((row, i) => {
    const parsed = extractMonthYearGlobal(row[cols.month]);
    const isCurrent = parsed && parsed.month === todayMonth && parsed.year === todayYear;
    // For pre-start, mark the next upcoming month
    const isUpcoming = !isCurrent && parsed && 
      new Date(parsed.year, parsed.month - 1, 1) > new Date(todayYear, todayMonth - 1, 1);

    const label = parsed ? monthLabel(parsed) : (row[cols.month] || 'Month ' + (i+1));

    const waist  = cols.waist  >= 0 ? row[cols.waist]  : 'â€”';
    const belly  = cols.belly  >= 0 ? row[cols.belly]  : 'â€”';
    const hips   = cols.hips   >= 0 ? row[cols.hips]   : 'â€”';
    const chest  = cols.chest  >= 0 ? row[cols.chest]  : 'â€”';
    const weight = cols.weight >= 0 ? row[cols.weight] : 'â€”';

    html += `
    <div class="month-card ${isCurrent ? 'current-month' : ''}" id="mcard-${i}">
      <div class="month-card-header" onclick="toggleMonthCard(${i})">
        <div>
          <div class="month-name">${label}</div>
          <div class="month-weight">${weight} target</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          ${isCurrent ? '<span class="month-badge">This Month</span>' : ''}
          <span class="chevron">â–¼</span>
        </div>
      </div>
      <div class="month-measurements">
        <div class="meas-cell ${isCurrent ? 'current-month-cell' : ''}">
          <div class="meas-cell-label">Waist (Pants)</div>
          <div class="meas-cell-value">${waist || 'â€”'}</div>
        </div>
        <div class="meas-cell ${isCurrent ? 'current-month-cell' : ''}">
          <div class="meas-cell-label">Belly Button</div>
          <div class="meas-cell-value">${belly || 'â€”'}</div>
        </div>
        <div class="meas-cell ${isCurrent ? 'current-month-cell' : ''}">
          <div class="meas-cell-label">Hips</div>
          <div class="meas-cell-value">${hips || 'â€”'}</div>
        </div>
        <div class="meas-cell ${isCurrent ? 'current-month-cell' : ''}">
          <div class="meas-cell-label">Chest</div>
          <div class="meas-cell-value">${chest || 'â€”'}</div>
        </div>
      </div>
    </div>`;
  });

  body.innerHTML = html;

  // Auto-expand current month (or first upcoming)
  const currentIdx = roadmapRows.findIndex(row => {
    const p = extractMonthYearGlobal(row[cols.month]);
    return p && p.month === todayMonth && p.year === todayYear;
  });
  if (currentIdx >= 0) {
    document.getElementById('mcard-' + currentIdx).classList.add('expanded');
  } else {
    // find first upcoming
    let firstUpcoming = -1;
    roadmapRows.forEach((row, i) => {
      const p = extractMonthYearGlobal(row[cols.month]);
      if (p && new Date(p.year, p.month-1,1) >= new Date(todayYear, todayMonth-1,1) && firstUpcoming < 0) {
        firstUpcoming = i;
      }
    });
    if (firstUpcoming >= 0) document.getElementById('mcard-' + firstUpcoming).classList.add('expanded');
  }
}

function toggleMonthCard(i) {
  document.getElementById('mcard-' + i).classList.toggle('expanded');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESULTS PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let savedResults = {};

function loadSavedResults() {
  try { savedResults = JSON.parse(store.get('tracker_results') || '{}'); } catch(e) { savedResults = {}; }
}

function saveSavedResults() {
  store.set('tracker_results', JSON.stringify(savedResults));
}

function renderResultsPage() {
  loadSavedResults();
  if (!roadmapRows.length) {
    document.getElementById('comparison-grid').innerHTML = '<div style="padding:20px;font-family:Space Mono,monospace;font-size:11px;color:var(--muted);">Upload CSV first.</div>';
    return;
  }

  const cols = getColIndices();
  const picker = document.getElementById('results-month-picker');
  picker.innerHTML = '';

  const today = new Date();
  const todayMonth = today.getMonth() + 1;
  const todayYear = today.getFullYear();

  let defaultIdx = 0;
  roadmapRows.forEach((row, i) => {
    const parsed = extractMonthYearGlobal(row[cols.month]);
    const label = parsed ? monthLabel(parsed) : (row[cols.month] || 'Month ' + (i+1));
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = label;
    picker.appendChild(opt);

    // Default to current month or first upcoming
    if (parsed) {
      if (parsed.month === todayMonth && parsed.year === todayYear) defaultIdx = i;
      else if (new Date(parsed.year, parsed.month-1,1) >= new Date(todayYear,todayMonth-1,1) && defaultIdx === 0) defaultIdx = i;
    }
  });
  picker.value = defaultIdx;

  renderResultsForm();
  renderResultsHistory();
}

function renderResultsForm() {
  const cols = getColIndices();
  const idx = parseInt(document.getElementById('results-month-picker').value);
  const row = roadmapRows[idx];
  if (!row) return;

  const parsed = extractMonthYearGlobal(row[cols.month]);
  const key = parsed ? `${parsed.year}-${String(parsed.month).padStart(2,'0')}` : `row-${idx}`;
  const existing = savedResults[key] || {};

  const fields = [
    { id: 'waist', label: 'Waist (Pants)', col: cols.waist },
    { id: 'belly', label: 'Belly Button', col: cols.belly },
    { id: 'hips',  label: 'Hips',         col: cols.hips  },
    { id: 'chest', label: 'Chest',         col: cols.chest },
    { id: 'weight', label: 'Weight',       col: cols.weight },
  ];

  let html = '';
  fields.forEach(f => {
    const target = f.col >= 0 ? (row[f.col] || 'â€”') : 'â€”';
    const actual = existing[f.id] || '';
    const diff = calcDiff(target, actual, f.id);

    html += `
    <div class="comp-cell">
      <div class="comp-cell-label">${f.label}</div>
      <div class="comp-target">${target}</div>
      <div class="comp-actual-wrap">
        <input class="comp-actual-input" type="text" id="inp-${f.id}" value="${actual}" 
               placeholder="â€”" oninput="updateDiff('${f.id}', '${target}')">
        <span class="comp-diff ${diff.cls}" id="diff-${f.id}">${diff.text}</span>
      </div>
    </div>`;
  });

  document.getElementById('comparison-grid').innerHTML = html;
  document.getElementById('comparison-grid').dataset.key = key;
}

function calcDiff(target, actual, fieldId) {
  if (!actual || !target || target === 'â€”') return { text: '', cls: 'neutral' };
  // Strip non-numeric except decimal
  const t = parseFloat(target.toString().replace(/[^0-9.]/g,''));
  const a = parseFloat(actual.toString().replace(/[^0-9.]/g,''));
  if (isNaN(t) || isNaN(a)) return { text: '', cls: 'neutral' };
  const diff = a - t;
  const sign = diff > 0 ? '+' : '';
  // For measurements and weight, lower is better
  const better = diff < 0;
  const cls = diff === 0 ? 'neutral' : (better ? 'better' : 'worse');
  return { text: sign + diff.toFixed(1), cls };
}

function updateDiff(fieldId, target) {
  const actual = document.getElementById('inp-' + fieldId).value;
  const diff = calcDiff(target, actual, fieldId);
  const el = document.getElementById('diff-' + fieldId);
  el.textContent = diff.text;
  el.className = 'comp-diff ' + diff.cls;
}

function saveResults() {
  const key = document.getElementById('comparison-grid').dataset.key;
  if (!key) return;
  const fields = ['waist','belly','hips','chest','weight'];
  const entry = {};
  fields.forEach(f => {
    const val = document.getElementById('inp-' + f);
    if (val) entry[f] = val.value.trim();
  });
  savedResults[key] = entry;
  saveSavedResults();
  renderResultsHistory();
  showToast('âœ“ Results saved!');
}

function renderResultsHistory() {
  loadSavedResults();
  const list = document.getElementById('results-history-list');
  const keys = Object.keys(savedResults).sort().reverse();
  if (!keys.length) {
    list.innerHTML = '<div class="no-results" style="padding:20px 0">No results saved yet.</div>';
    return;
  }
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  list.innerHTML = keys.map(key => {
    const r = savedResults[key];
    const [yr, mo] = key.split('-');
    const monthLabel = (months[parseInt(mo)-1] || mo) + ' ' + yr;
    return `<div class="history-row">
      <div class="history-month">${monthLabel}</div>
      <div class="history-measurements">
        ${r.waist  ? `<div class="history-meas">W:<span>${r.waist}</span></div>` : ''}
        ${r.belly  ? `<div class="history-meas">B:<span>${r.belly}</span></div>` : ''}
        ${r.hips   ? `<div class="history-meas">H:<span>${r.hips}</span></div>`  : ''}
        ${r.chest  ? `<div class="history-meas">C:<span>${r.chest}</span></div>` : ''}
        ${r.weight ? `<div class="history-meas">Wt:<span>${r.weight}</span></div>` : ''}
      </div>
      <button class="history-delete" onclick="deleteResult('${key}')">âœ•</button>
    </div>`;
  }).join('');
}

function deleteResult(key) {
  if (confirm('Delete results for ' + key + '?')) {
    delete savedResults[key];
    saveSavedResults();
    renderResultsHistory();
  }
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA â€” MANIFEST (injected via JS blob, works around data: URI restrictions)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function injectManifest() {
  const manifest = {
    name: "TRACK // Daily",
    short_name: "TRACK //",
    description: "Daily weight loss tracker",
    start_url: window.location.href,
    display: "standalone",
    background_color: "#0a0a0a",
    theme_color: "#0a0a0a",
    orientation: "portrait",
    icons: [
      { src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAIAAADdvvtQAAADHUlEQVR42u3d0W3DMAwE0Hxzse6/RbZodyhlS+K9w/3bIB6aoLHFT4k08jECAUgAEoAEIBGABCABSAASAUgAEoAEIBGABCC5GtD390dnFyAFSAFSgAACCCAFSAFSgAACCCAFSAFSgBSgBwH5mfrAAFR0ArRmBDQAtGAETADUvToWAC24OhwAda/OB0ALrk4JQN2rgwJQ9+oYAdQFxBBAXUAYAbQAEEMAdQFhBNACQAwBVO8/7wIQQAwBtBpQJiOAau/jmwABFM0IoDrkSXKAAEpkBFCd9lILQAAFMQLo1dcaAQIII4B2A5pkCKCdb+YDBFC6IYD2G7qaEUAMAYQRQOcMlyGAMALogJkyBBBGAB0wSoYAwgigAybIEEB++gAo2xBAEwBtZATQHEDlYTSArmME0EBAFfxkPkCXMQJoMqDKe00RoMsYARQBqGLObADoMkYAZQGq6QdYAXQZI4BCAdXQ0zwBuowRQOmAatbR5gBdxggggFqGAAKoxQigOYAW3hJAoYDW3hVAiYBeNgTQQEBvMgJoLKB3DAE0GdDymwQoDtDThgCaD+iJWwUoC9Bzf4oACgKUsPEJoLNmBxBA1j0BtBqQX4IB6gKy7gmgBYBiH4sDaBkg+8IA6gKyLwygLqC0l0wAWg/IvjCA7JwD6ABAFs4BZOEcQLsBzT6/BqA3AFk4B1CcIYBOBGRjIUA2FgK0G9Cko7EB2gPIxsLJgBgCiCGAkhgBNBZQrCGAfJwBxBBAgf+cnWEIIF+JAGIIIOueLmUEEEMAMbRvRAD5SgQQQ/sGBZCPM4AY2jcxgBgCCKN9cwOIIYAY2jc9gFIMAeTAZYAA2scIoAhAdduZDQClGAIoCFDdc/gQQCmGAIoDtJYRQKGA6uzzhAFKMQRQNKA69WB8gFIMAQRQixFAALUMAQRQyxBAALUMAQRQyxBAALUGCBBAF/8JBEgAEoAEIIAAAkgAEoAEIIAAAgigOwDpvQVIAVKAFCCAAAJIAVKAFCCAAAJIAVKAFCAF6D+ARAASgAQgAUgAEgFIABKABCARgAQgAUgAEgFInswfgfNL6Jcr9lYAAAAASUVORK5CYII=", sizes: "192x192", type: "image/png", purpose: "any maskable" },
      { src: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAANw0lEQVR42u3Y0Q2AMAzE0H53sey/BVvAFEhV/aybIL3EgrUBAEmWEQAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAACXCOB5R0RECEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAAhARIQACEBEhAAIQESEAERECIAAREQIgABERAiAAERECIAAREQIgABERAiAAERECIAAREQIgABERAiAAERECIAAREQIgABERAjgegFsAHCgCOD6ylpdwIEigKgAOABwoAigKwAaABwoAkgLgAMAB4oAJl5Zyww4UATQrax9BhwoAkhX1lYDDhQBdCtrsQEHigDSlbXegANFAN3K2nCAAMw3XVl7DhCA+XYra9UBAjDfdGUtPEAA5tutrJ0HCMB805W1+QABmG+3spYfIADzTVfWCQABEID5divrCoAACMB805V1C0AABGC+3co6ByAAAjDfdGUdBRAAAZhvt7LuAmwTAZhvurKuA2wTAZivygK2iQDMN1ZZGoBtIgDzTQuAA2CbCMB8uwKgAdgmAjDftAA4ALaJAMy3KwAagG0iAPNNC4ADYJsIwHy7AqAB2CYCMN+0ADgAtokACKArABqAbSIAAkgLgANgmwiAALoCoAHYJgIggLQAOAC2iQAIoCsAGoBtIgACSAuAA2CbCMC56QqABmCbCMChSQuAA2CbCMCV6QqABmCbCMB9SQuAA0AABOC4dAVAAyAAAnBW0gLgABAAAbgpXQHQAAiAAFyTtAA4AARAAE5JVwA0AAeKAByRtAA4AA4UAbggXQHQABwoAnA70gLgADhQBOBwdAVAA3CgCMDJSAuAA+BAEYB70RUADcCBIgCXIi0ADoADRQDORFcANAAHigAciLQAOAAOFAEQwMTjbMGBIgAC4ADAgSIAAqABwIEiAJXlAMCBIgCVpQGAAMxXZTkAIADzVVkaAAjAfFWWA0AABGC+KksDIAACMF+V5QDYJgIwXwKgAdgmAjBfAuAA2CYCMF8CoAHYJgIwXwLgANgmAiAAAqAB2CYCIAAC4ADYJgIgAAKgAdgmArDPBMABIAACsMwEQAMgAAKwxgTAAXCgCMAOcwANwIEiANvLARwAB4oArC4N0AAcKAKwtBygTnCgCMDG0oBSwYEiALvKAXoFB4oAQAPaBQeKAHRaFAwOFAFotqgZCMB8lVs0DQRgviou+gYCMF8tF5WzGgRgvrouimcpCMB81V10z0YQgPkqvWigXSAA89V7UUKLQADmq/2iilaAAAjAAog26j8BEIA1EJ3UfAIgAJsgaqn2BGDT7AMNgAAIwI5ZCQ4AARCABbMYNAACIACrxQEcAAeKAOwVDdAAHCgCsFEcwAFwoAjAOtEAB8CBIgC7xAEEAAeKAOwSDRAAHCgCsEscQABwoAgANEAAcKAIABxAACAA8wUNEAAIwHzBAQQAAjBf0AABaCwBmC84gADUlQDMFzSgtIpKAOYLDlBaLSUA8wUNKK1+EoD5ggOUVjkJwHxBA0qrlgRAAOAApdVJAiAA0IDSaiMB2CVwgNKqIgHYJdCA0hIAAdglcIDSEgAB2CUQABwoArBL9pAA4EARgF2yjQQAB4oA7JKFJAA4UARgl6wlAcCBIgC7ZDMJAA4UAdgl+0kAcKAIAFaUAOBAEQAsKgHAgSIA2FUCAAGYL2wsAYAAzBeWlgB0iQDMF1aXALSIAMwXtpcAVIgAzBd2WGmVhwDMF9ZYaTWHAMwXlllpdYYAzBccoLQKQwAEABpQWlUhAAIAByitnhAAAYAGlFZDCMAugQOUlgAIwC6BBpSWAAjALiHvAO9CAARglxDVgBchAAKwS4g6wHMQAAHYJUQ14CEIgADsEqIO8AoEQAB2CVENmD8BEIBdQtQBhk8ABGCXENWAsRMAAdilS3bJOVBaL04ABNDdJUdBab01Adil7i65C0rroQmAANK75DoorScmAALo7pIDobQEQAAE0N0lZ0JpCYAACKC7Sy6F0hIAARBAd5fcC6UlAAIggPQuORlKSwAEQADdXXI4lJYACIAAurvkdigtARAAAXR3yQVRWgIgAALo7pIjorQEQAAEkN4lp0RtCIAACMAFpEA4UARAAL1d8isMDhQBEEB3l7KjUBsCIAACsEvTHIjaEAABEIBdin4KqA0BEAAB2KXop4DaEAABOBx2KeoAtSEAAnA17FLiNZWWAAiAAOwSBygtARCAe2GX2hpQGwIgAJfCLkUdoDYEQADOhF3yuHCgCMCNsEveFw4UATgQdskTw4EiANfBLnloOFAE4C7YJW8NpSUARyG7S54bDhQBuAhdAXhxOFAE4Bx0BeDR4UARgFvQFYCnhwNFAK5AWgBeHw4UAaArAAWAA0UA6ApAB+BAEQC6AlADOFAEgK4AlAEOFAEgLQB9gANFAOgKQCXgQBEAugLQCjhQBICuABQDBGC+6ApAPUAA5ou0ADQEBGC+6ApASUAA5ouuAPQEBGC+6ApAVUAA5ouuABQGBGC+SAtAZ0AA5ouuANRGaQnAfNEVgOYoLQGYL7oCUB6lJQDzRVcAKqS0BGC+SAtAi5SWAMwXXQEoktISgPmiKwBdUloCMF90BaBOSksA5ouuAJRKaQnAfJEWgF4pLQGYL7oCUC2lJQDzRVcA2qW0BGC+6ApAwZSWAMwXXQGomdISgPkiLQBNU1oCMF90BaBsSksA5ouuAPRNaQnAfNEVgMopLQGYL7oCUDylJQACQFoAuqe0BEAAdmk4AEpLAARglzgASksA1s8ucQCUlgDsnl2iARAAAdg6u8QBIAACsHJ2iQPgQBGAfbNLHAAHigAsm3XiADhQBGDTbBQNwIEiADtmrzgADhQBWDCrxQFwoAjAdtkuDoADRQDgAA6AA0UA4AAagANFAKABDgABmC84gANAAOYLDuAAhSQA8wUHcIA2EoD5ggNoQBUJwHxBAxyghARgvuAANdZAAjBfcIAmqx8BmC84QJl1jwAIAByg0opHAAQAGtBqlSMAAgAHKLa+EYA9AQfoNgEQgCUBB6g3ARCADQEHKDkBEIDdAA3ouQNFABYDHKDqDhQB2ApwgLY7UARgJSyqKLwDRQD2wa6K2jtQBGATbKxovgNFANbA0nIAHCgCgL3lADhQBACrywEgAPOF7aUBEID5wg5zAAjAfGGNOUBzCMB8YZM5QG0IwHxhmTlAZwjAfGGfaUBhCMB8Yas5QFUIwHxhsTlATwjAfGG3OUBJCIAAwAEcoCEEQADgABpQDwLQadAABygGASg0OIADCIAAtBkcwAEEQACqDA7gAAeKAPQYHEADDhQBaDBogAMcKAJQX3CAJXKgCEB3wQH2yIEiAAIAB1glB4oACAAcYJscKAIAaMA2OVAEAHCAbXKgCADgANtEAOYLcIBtIgDzBTiAAAjAfAEaIAACMF+AAwiAAMwXyDrA4xKA+QJRB3hZAjBfIOoAz0oA5gtENeBBCcB8gagDvCYBmC8QdYCnJADzBaIO8I4EYL5A1AEekQDMF4hqwPMRgPkCUQd4OwIwXyDqAA9HAOYLRB3g1QjAfIGoAzwZAZgvENWAxyIA8wWiDvBSBGC+QNQBnokAzBeIOsAbEYD5AlEHeCACMF8gqgFPQwDmC0Qd4F0IwHyBqAM8CgGYLxB1gBchAPMFog7wHARgvkBUAx6CAMwXiDrAKxCA+QJRB3gCAjBfIOoA8ycA8wWiDjB8AjBfIKoBYycA8wWiDjBzAjBfIOoAAycA8wWiDjBtAjBfIOoAoyYA8wWiGjBkAjBfIOoAEyYA8wWiDjBeAjBfIOoAsyUA8wWiDjBYAjBfwLUyUgIwX6B0sMyTAMwXiN4swyQA8wWiZ8skCcB8gejlMkYCMF8ABEAA5guAAAjAfAEQAAGYLwACIAACAEAABEAAAAiAAAgAAAEQAAEAIAACIAAABEAABADAgSIAAgDgQBEAAQBwoAiAAAA4UARAAAAcKAIgAAAOFAEQAAAHigAAwIEiAABwoAgAAAjAfAGAAMwXAAjAfAEQAAGYLwACIADzBUAABGC+AAiAAMwXAAEQwIHzFRE5NgQgIkIABCAiQgAEICJCAAQgIkIABCAiQgAEICJCAAQgIkIABCAiQgAEICJCAAQgIkIABCAiQgAEICJCAAQgIkIABCAiQgAEICJCAAQgIkIABCAiQgAEICJCAAQgIkIABCAiQgAEICJCAAQgIkIABCAiQgAiIgRAACIiBEAAIiIEQAAiIgRAACIiBEAAIiIEQAAiIgRAACIiBEAAIiIEQAAiIgRAACIiBEAAIiIEAACoQQAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAD4iQ9hq6g0hpfGPgAAAABJRU5ErkJggg==", sizes: "512x512", type: "image/png", purpose: "any maskable" }
    ]
  };
  const blob = new Blob([JSON.stringify(manifest)], {type: 'application/manifest+json'});
  const url = URL.createObjectURL(blob);
  const link = document.createElement('link');
  link.rel = 'manifest';
  link.href = url;
  document.head.appendChild(link);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA â€” SERVICE WORKER (registered via blob so no extra file needed)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function registerSW() {
  if (!('serviceWorker' in navigator)) return;

  const swCode = `
    const CACHE = 'track-v1';
    const ASSETS = []; // single HTML file â€” cache self on install

    self.addEventListener('install', e => {
      e.waitUntil(
        caches.open(CACHE).then(cache => cache.addAll(ASSETS))
      );
      self.skipWaiting();
    });

    self.addEventListener('activate', e => {
      e.waitUntil(
        caches.keys().then(keys =>
          Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))
        )
      );
      self.clients.claim();
    });

    self.addEventListener('fetch', e => {
      e.respondWith(
        caches.match(e.request).then(cached => cached || fetch(e.request).catch(() => cached))
      );
    });
  `;

  const blob = new Blob([swCode], { type: 'application/javascript' });
  const swUrl = URL.createObjectURL(blob);

  navigator.serviceWorker.register(swUrl, { scope: '/' })
    .then(reg => {
      console.log('SW registered:', reg.scope);
      // Cache this page itself for offline use
      if ('caches' in window) {
        caches.open('track-v1').then(cache => {
          cache.add(window.location.href).catch(() => {});
        });
      }
    })
    .catch(err => console.log('SW registration skipped:', err));
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA â€” INSTALL PROMPT (Android Chrome "Add to Home Screen")
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let deferredInstallPrompt = null;

window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredInstallPrompt = e;
  // Show install banner after a short delay if not already installed
  setTimeout(showInstallBanner, 3000);
});

window.addEventListener('appinstalled', () => {
  hideInstallBanner();
  deferredInstallPrompt = null;
  showToast('âœ“ App installed!');
});

function showInstallBanner() {
  if (!deferredInstallPrompt) return;
  if (document.getElementById('install-banner')) return;
  const banner = document.createElement('div');
  banner.id = 'install-banner';
  banner.style.cssText = `
    position: fixed; bottom: 0; left: 0; right: 0; max-width: 480px; margin: 0 auto;
    background: #e8ff47; color: #0a0a0a; padding: 14px 20px;
    display: flex; align-items: center; justify-content: space-between;
    font-family: 'Space Mono', monospace; font-size: 11px; letter-spacing: 1px;
    z-index: 9997; border-top: 2px solid #0a0a0a;
  `;
  banner.innerHTML = `
    <span>âš¡ Add TRACK // to home screen</span>
    <div style="display:flex;gap:8px;">
      <button onclick="installApp()" style="background:#0a0a0a;color:#e8ff47;border:none;padding:8px 14px;font-family:inherit;font-size:10px;letter-spacing:1px;cursor:pointer;">INSTALL</button>
      <button onclick="hideInstallBanner()" style="background:transparent;border:none;font-size:18px;cursor:pointer;color:#0a0a0a;padding:0 4px;">âœ•</button>
    </div>
  `;
  document.body.appendChild(banner);
}

function hideInstallBanner() {
  const b = document.getElementById('install-banner');
  if (b) b.remove();
}

async function installApp() {
  if (!deferredInstallPrompt) return;
  hideInstallBanner();
  deferredInstallPrompt.prompt();
  const { outcome } = await deferredInstallPrompt.userChoice;
  if (outcome === 'accepted') showToast('âœ“ Installing...');
  deferredInstallPrompt = null;
}

</script>
</body>
</html>
